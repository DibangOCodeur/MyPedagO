{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Gestion Pédagogique</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/connexion/connexion.css' %}">
</head>
<body>
    <!-- Bouton de changement de thème flottant -->
    <button id="themeToggle" class="theme-toggle" aria-label="Changer de thème">
        <i class="fas fa-moon"></i>
        <i class="fas fa-sun"></i>
    </button>

    <!-- Page de connexion avec animations -->
    <div id="loginPage" class="login-container">
        <div class="login-box animated fadeInUp">
            <div class="login-header">
                <h1><img src="{% static 'images/logo/IIPEA.png' %}" alt="Logo" class="logo-img"></h1>
                <p class="text-fade">Système de Gestion Pédagogique</p>
            </div>

            <!-- Messages d'erreur ou de succès -->
            {% if messages %}
                {% for message in messages %}
                    <div class="message-alert message-{% if message.tags == 'error' %}danger{% elif message.tags == 'success' %}success{% else %}info{% endif %} slide-in">
                        <i class="fas fa-{% if message.tags == 'error' %}exclamation-triangle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %} me-2"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <form id="loginForm" class="form-animate" method="post" action="{% url 'connexion' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="email" class="label-animate">Email</label>
                    <input type="email" name="email" id="email" class="form-control input-animate" 
                           placeholder="Entrez votre email de connexion" 
                           value="{{ request.POST.email|default:'' }}"
                           required autocomplete="email">
                    <div class="input-icon">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="password" class="label-animate">Mot de passe</label>
                    <input type="password" name="password" id="password" class="form-control input-animate" 
                            placeholder="Entrez votre mot de passe" required autocomplete="current-password">
                    <div class="input-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="password-toggle">
                        <i class="fas fa-eye"></i>
                        <i class="fas fa-eye-slash"></i>
                    </div>
                </div>
                <div class="form-options slide-in">
                    <label class="remember-me">
                        <input type="checkbox" name="remember" id="remember">
                        <span class="checkmark"></span>
                        Se souvenir de moi
                    </label>
                    <a href="#" class="forgot-password" id="forgotPassword">Mot de passe oublié?</a>
                </div>
                <button type="submit" class="btn btn-animate">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
                <div class="social-login slide-in-delay">
                    <p>Ou connectez-vous avec</p>
                    <div class="social-icons">
                        <a href="#" class="social-icon google"><i class="fab fa-google"></i></a>
                        <a href="#" class="social-icon microsoft"><i class="fab fa-microsoft"></i></a>
                        <a href="#" class="social-icon apple"><i class="fab fa-apple"></i></a>
                    </div>
                </div>
                <div class="register-link slide-in-delay">
                    Pas encore de compte? <a href="#" id="registerLink">Contactez l'administrateur</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Popup Mot de passe oublié -->
    <div id="forgotPasswordPopup" class="popup-container">
        <div class="popup-box zoom-in">
            <div class="popup-header">
                <h2><i class="fas fa-key"></i> Réinitialisation du mot de passe</h2>
                <button class="close-popup">&times;</button>
            </div>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="resetEmail">Email associé au compte</label>
                    <input type="email" id="resetEmail" required>
                    <div class="input-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                </div>
                <button type="submit" class="btn">Envoyer le lien de réinitialisation</button>
            </form>
        </div>
    </div>
    <script>
        // Gestion du thème
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Vérifier le thème sauvegardé ou la préférence système
        const currentTheme = localStorage.getItem('theme') || 
                           (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        setTheme(currentTheme);
        
        themeToggle.addEventListener('click', () => {
            const newTheme = body.classList.contains('dark-theme') ? 'light' : 'dark';
            setTheme(newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Animation du bouton
            themeToggle.classList.add('pulse');
            setTimeout(() => themeToggle.classList.remove('pulse'), 500);
        });
        
        function setTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark-theme');
                themeToggle.querySelector('.fa-moon').style.display = 'none';
                themeToggle.querySelector('.fa-sun').style.display = 'inline-block';
            } else {
                body.classList.remove('dark-theme');
                themeToggle.querySelector('.fa-moon').style.display = 'inline-block';
                themeToggle.querySelector('.fa-sun').style.display = 'none';
            }
        }

        // Animation au chargement
        document.addEventListener('DOMContentLoaded', () => {
            const elements = document.querySelectorAll('.animated, .label-animate, .input-animate, .slide-in, .slide-in-delay');
            elements.forEach(el => {
                el.style.opacity = '0';
                if (el.classList.contains('slide-in')) {
                    el.style.transform = 'translateX(-20px)';
                } else if (el.classList.contains('slide-in-delay')) {
                    el.style.transform = 'translateX(20px)';
                } else {
                    el.style.transform = 'translateY(20px)';
                }
            });
            
            setTimeout(() => {
                elements.forEach((el, i) => {
                    setTimeout(() => {
                        el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        el.style.opacity = '1';
                        el.style.transform = 'translate(0)';
                    }, 100 * i);
                });
            }, 300);
        });

        // Toggle mot de passe visible
        const passwordToggle = document.querySelector('.password-toggle');
        const passwordInput = document.getElementById('password');
        
        passwordToggle.addEventListener('click', () => {
            const isVisible = passwordInput.type === 'text';
            passwordInput.type = isVisible ? 'password' : 'text';
            passwordToggle.querySelector('.fa-eye').style.display = isVisible ? 'block' : 'none';
            passwordToggle.querySelector('.fa-eye-slash').style.display = isVisible ? 'none' : 'block';
            
            // Animation
            passwordToggle.classList.add('shake');
            setTimeout(() => passwordToggle.classList.remove('shake'), 500);
        });

        // Gestion du popup mot de passe oublié
        const forgotPasswordLink = document.getElementById('forgotPassword');
        const forgotPasswordPopup = document.getElementById('forgotPasswordPopup');
        const closePopup = document.querySelector('.close-popup');
        
        forgotPasswordLink.addEventListener('click', (e) => {
            e.preventDefault();
            forgotPasswordPopup.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });
        
        closePopup.addEventListener('click', () => {
            forgotPasswordPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        // Fermer le popup en cliquant à l'extérieur
        forgotPasswordPopup.addEventListener('click', (e) => {
            if (e.target === forgotPasswordPopup) {
                forgotPasswordPopup.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Animation du formulaire au focus
        const formControls = document.querySelectorAll('.form-control');
        
        formControls.forEach(control => {
            control.addEventListener('focus', () => {
                control.parentElement.classList.add('focused');
            });
            
            control.addEventListener('blur', () => {
                control.parentElement.classList.remove('focused');
            });
        });

        // Effet de vague sur le bouton de connexion
        const loginBtn = document.querySelector('.btn');
        
        loginBtn.addEventListener('mouseenter', () => {
            loginBtn.classList.add('hover-effect');
        });
        
        loginBtn.addEventListener('mouseleave', () => {
            loginBtn.classList.remove('hover-effect');
        });

        // Animation au submit du formulaire
        const loginForm = document.getElementById('loginForm');
        
        loginForm.addEventListener('submit', () => {
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion en cours...';
            loginBtn.disabled = true;
        });
    </script>
</body>
</html>