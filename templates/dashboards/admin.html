<!DOCTYPE html>
{% load static  %}
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Administrateur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/dashboards/admin.css' %}">
</head>
<body>
    <!-- Bouton de changement de th√®me -->
    <button id="themeToggle" class="theme-toggle" aria-label="Changer de th√®me">
        <i class="fas fa-moon"></i>
        <i class="fas fa-sun"></i>
    </button>

    <!-- Menu mobile -->
    <button id="mobileMenuToggle" class="mobile-menu-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="{% static 'images/logo/IIPEA.png' %}" alt="Logo" class="logo-img">
                <h2>{{user.get_full_name}}</h2>
                <p>{{user.email}} </p>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active">
                    <a href="{% url 'dashboard_admin' %}" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
                
                <!-- Utilisateurs avec sous-menu -->
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-users-cog"></i>
                        Utilisateurs
                        {% comment %} <span class="notification-badge">5</span> {% endcomment %}
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'user_list' %}" class="submenu-item">Tous les Utilisateurs</a>
                        <a href="{% url 'professeur_list' %}" class="submenu-item">Tous les Professeurs   </a>
                        <a href="{% url 'user_create' %}" class="submenu-item">Cr√©er un Utilisateur</a>
                    </div>
                </div>
                
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-users"></i>
                        Classes
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'classe_list' %}" class="submenu-item">Liste de classes</a>
                        <a href="#" class="submenu-item">Nouvelle Classe</a>
                    </div>
                </div>
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-project-diagram me-2"></i>
                        Maquettes
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'maquette_list' %}" class="submenu-item">Liste de Maquettes</a>
                        <a href="#" class="submenu-item">Nouvelle Maquettes</a>
                    </div>
                </div>
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-clipboard-list"></i>
                        Pointages
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="#" class="submenu-item">Pointage</a>
                        <a href="#" class="submenu-item">Nouveau Pointage</a>
                    </div>
                </div>
                <div class="nav-item has-submenu">
                    <a href="#" class="nav-link">
                        <i class="fas fa-calendar-alt"></i>
                        Emplois du temps
                    </a>
                </div>
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-file-signature"></i>
                        Pr√©contrats
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'precontrat_list' %}" class="submenu-item">Liste des Pr√©contrats</a>
                        <a href="{% url 'precontrat_create' %}" class="submenu-item">Nouveau Pr√©contrat</a>
                    </div>
                </div>
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-file-contract"></i>
                        Contrats
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'contrat_list' %}" class="submenu-item">Liste des contrats</a>
                        <a href="#" class="submenu-item">Nouveau contrat</a>
                    </div>
                </div>
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-wallet"></i>
                        Paiements
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="#" class="submenu-item">Liste des paiements</a>
                        <a href="#" class="submenu-item">Nouveau paiement</a>
                    </div>
                </div>
                
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-folder-open"></i>
                        Dossiers
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="#" class="submenu-item">Dossiers des profs</a>
                        <a href="#" class="submenu-item">Dossiers de cours</a>
                    </div>
                </div>
                
                <div class="nav-item has-submenu">
                    <div class="nav-link submenu-toggle">
                        <i class="fas fa-cogs"></i>
                        Param√®tres
                        <i class="fas fa-chevron-down submenu-icon"></i>
                    </div>
                    <div class="submenu">
                        <a href="{% url 'user_change_password' pk=request.user.pk %}" class="submenu-item"> Changer MDP</a>
                        <a href="#" class="submenu-item">Maintenance</a>
                        <a href="#" class="submenu-item">Sauvegardes</a>
                    </div>
                </div>

                <div class="nav-item logout">
                    <a href="{% url 'deconnexion' %}" class="nav-link">
                        <i class="fas fa-sign-out-alt"></i>
                        D√©connexion
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="welcome-section">
                    <h1>Tableau de bord Administrateur</h1>
                    <p>Acc√®s complet au syst√®me - <span id="currentTime"></p>
                </div>
                <div class="user-profile">
                    <div class="user-avatar admin">
                        <a href="{% url 'admin:index' %}">
                            <i class="fas fa-user-shield"></i>
                        </a>
                    </div>
                    <div class="user-info">
                        <h3>{{user.get_full_name}}</h3>
                        <span>{{user.get_role_display}}</span>
                    </div>
                    <div class="user-notification">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">7</span>
                    </div>
                </div>
            </header>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">143</div>
                    <div class="stat-label">Utilisateurs Actifs</div>
                    <div class="stat-progress">
                        <i class="fas fa-arrow-up"></i>
                        <span>12% ce mois</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon security">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">3</div>
                    <div class="stat-label">Alertes S√©curit√©</div>
                    <div class="stat-progress negative">
                        <i class="fas fa-arrow-up"></i>
                        <span>1 nouvelle</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon storage">
                            <i class="fas fa-database"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">78%</div>
                    <div class="stat-label">Espace Stockage</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 78%"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon performance">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">96%</div>
                    <div class="stat-label">Performance</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 96%"></div>
                    </div>
                </div>
            </div>


            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">143</div>
                    <div class="stat-label">Utilisateurs Actifs</div>
                    <div class="stat-progress">
                        <i class="fas fa-arrow-up"></i>
                        <span>12% ce mois</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon security">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">3</div>
                    <div class="stat-label">Alertes S√©curit√©</div>
                    <div class="stat-progress negative">
                        <i class="fas fa-arrow-up"></i>
                        <span>1 nouvelle</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon storage">
                            <i class="fas fa-database"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">78%</div>
                    <div class="stat-label">Espace Stockage</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 78%"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon performance">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <i class="fas fa-ellipsis-v stat-menu"></i>
                    </div>
                    <div class="stat-number">96%</div>
                    <div class="stat-label">Performance</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 96%"></div>
                    </div>
                </div>
            </div>
            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Quick Actions -->
                <section class="quick-actions">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-bolt"></i>
                            Actions Administratives
                        </h2>
                        <button class="section-menu">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    <div class="action-buttons">
                        <a href="{% url 'user_create' %}" class="action-btn">
                            <i class="fas fa-user-plus"></i>
                            Nouvel Utilisateur
                        </a>
                        <a href="{% url 'user_change_password' pk=request.user.pk %}" class="action-btn">
                            <i class="fas fa-key"></i>
                            R√©initialiser MDP
                        </a>



                        {% if user.role == 'ADMIN' or user.role == 'INFORMATICIEN' %}
                        <button type="button" class="btn btn-primary btn-sync-all" onclick="syncAllData()">
                            <i class="fas fa-sync-alt"></i> Synchroniser tout
                        </button>
                        {% endif %}

                        {% if user.role == 'ADMIN' or user.role == 'INFORMATICIEN' %}
                        <button type="button" class="btn btn-primary btn-sync-all" onclick="sync_groupes()">
                            <i class="fas fa-sync-alt"></i> Synchroniser Les Groupes
                        </button>
                        {% endif %}
                        

                        


                        <a href="#" class="action-btn">
                            <i class="fas fa-download"></i>
                            Sauvegarde
                        </a>
                        <a href="#" class="action-btn">
                            <i class="fas fa-sync-alt"></i>
                            Mise √† Jour
                        </a>
                        <a href="#" class="action-btn">
                            <i class="fas fa-lock"></i>
                            Verrouiller Syst√®me
                        </a>
                        <a href="#" class="action-btn">
                            <i class="fas fa-file-export"></i>
                            Exporter Donn√©es
                        </a>
                        <a href="#" class="action-btn">
                            <i class="fas fa-tools"></i>
                            Maintenance
                        </a>
                        <a href="#" class="action-btn">
                            <i class="fas fa-ban"></i>
                            Bloquer Utilisateur
                        </a>
                    </div>
                </section>

                <!-- Recent Activity -->
                <section class="recent-activity">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-history"></i>
                            Activit√©s R√©centes
                        </h2>
                        <button class="section-menu">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon security">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Tentative de connexion suspecte</div>
                                <div class="activity-desc">IP: 192.168.1.45 bloqu√©e</div>
                            </div>
                            <div class="activity-time">Il y a 15 min</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon update">
                                <i class="fas fa-sync-alt"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Mise √† jour syst√®me</div>
                                <div class="activity-desc">Version 2.3.5 install√©e</div>
                            </div>
                            <div class="activity-time">Aujourd'hui, 08:30</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon user">
                                <i class="fas fa-user-edit"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Profil modifi√©</div>
                                <div class="activity-desc">Par M. Diallo Bintou</div>
                            </div>
                            <div class="activity-time">Hier, 17:45</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon warning">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Espace disque critique</div>
                                <div class="activity-desc">Serveur principal √† 85%</div>
                            </div>
                            <div class="activity-time">Hier, 12:20</div>
                        </div>
                    </div>
                    <a href="#" class="view-all">Voir tout le journal <i class="fas fa-arrow-right"></i></a>
                </section>
            </div>
        </main>
    </div>
    <script src="{% static 'js/bases/script.js' %}"></script>


<script>
// Fonction pour mettre √† jour l'heure en temps r√©el
function updateCurrentTime() {
    const now = new Date();
    
    // Options de formatage de la date
    const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    };
    
    // Format fran√ßais
    const formattedTime = now.toLocaleDateString('fr-FR', options);
    
    // Mettre √† jour l'√©l√©ment HTML
    document.getElementById('currentTime').textContent = formattedTime;
}

// Version simplifi√©e (seulement l'heure)
function updateSimpleTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    
    document.getElementById('currentTime').textContent = `Aujourd'hui, ${timeString}`;
}

// Version avec date compl√®te
function updateFullDateTime() {
    const now = new Date();
    const dateString = now.toLocaleDateString('fr-FR', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
    const timeString = now.toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    
    document.getElementById('currentTime').textContent = `${dateString} √† ${timeString}`;
}


// ########################Syncro des groupe ######################################################
class GroupeSynchronizer {
    constructor() {
        this.syncUrl = '{% url "sync_groupes" %}';
        this.statutUrl = '{% url "statut_groupes" %}';
        this.csrfToken = '{{ csrf_token }}';
    }
    
    // Synchroniser les groupes
    async synchroniser() {
        if (!confirm('Voulez-vous synchroniser tous les groupes ? Cela peut prendre plusieurs minutes.')) {
            return;
        }
        
        const btn = this._getBoutonSync();
        const texteOriginal = btn.innerHTML;
        
        try {
            this._afficherChargement(btn, 'Synchronisation en cours...');
            
            // Cr√©er les donn√©es de formulaire
            const formData = new FormData();
            formData.append('force', 'true');
            formData.append('csrfmiddlewaretoken', this.csrfToken);
            
            const response = await fetch(this.syncUrl, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': this.csrfToken
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                this._afficherResultats(data.stats);
                this.verifierStatut(); // Mettre √† jour le statut
            } else {
                this._afficherErreur(data.error || data.message);
            }
            
        } catch (error) {
            this._afficherErreur('Erreur de connexion: ' + error.message);
        } finally {
            this._restaurerBouton(btn, texteOriginal);
        }
    }
    
    // V√©rifier le statut
    async verifierStatut() {
        try {
            const response = await fetch(this.statutUrl);
            const data = await response.json();
            
            if (data.success) {
                this._afficherStatut(data.statut);
            }
        } catch (error) {
            console.error('Erreur statut:', error);
        }
    }
    
    // M√©thodes d'affichage
    _afficherResultats(stats) {
        let message = `‚úÖ Synchronisation r√©ussie!\n\n`;
        message += `üìä R√©sultats:\n`;
        message += `‚Ä¢ Strat√©gie: ${stats.strategie_utilisee || 'API Directe'}\n`;
        message += `‚Ä¢ Groupes trouv√©s: ${stats.groupes_trouves || 0}\n`;
        message += `‚Ä¢ Groupes cr√©√©s: ${stats.groupes_crees || 0}\n`;
        message += `‚Ä¢ Groupes mis √† jour: ${stats.groupes_mis_a_jour || 0}\n`;
        message += `‚Ä¢ Dur√©e: ${stats.duration || 0}s\n`;
        
        if (stats.errors && stats.errors.length > 0) {
            message += `\n‚ö†Ô∏è ${stats.errors.length} erreur(s) rencontr√©e(s)\n`;
            message += `Premi√®re erreur: ${stats.errors[0]}`;
        }
        
        // Afficher dans une div au lieu d'alert
        this._afficherNotification(message, 'success');
        
        // Recharger apr√®s 3 secondes pour voir les nouveaux groupes
        setTimeout(() => {
            if ((stats.groupes_crees || 0) > 0 && confirm('Recharger la page pour voir les nouveaux groupes ?')) {
                location.reload();
            }
        }, 3000);
    }
    
    _afficherStatut(statut) {
        const lastSync = statut.derniere_sync ? 
            new Date(statut.derniere_sync).toLocaleString('fr-FR') : 'Jamais';
        
        const details = statut.details || {};
        
        let message = `üìä Statut des groupes:\n\n`;
        message += `‚Ä¢ Total groupes: ${statut.total_groupes || 0}\n`;
        message += `‚Ä¢ Groupes actifs: ${statut.groupes_actifs || 0}\n`;
        message += `‚Ä¢ Classes avec groupes: ${details.classes_avec_groupes || 0}/${details.total_classes || 0}\n`;
        message += `‚Ä¢ Derni√®re sync: ${lastSync}\n`;
        message += `‚Ä¢ Sync n√©cessaire: ${statut.needs_sync ? '‚úÖ Oui' : '‚ùå Non'}`;
        
        // Mettre √† jour l'interface
        const statutElement = document.getElementById('statut-groupes');
        if (statutElement) {
            statutElement.innerHTML = `
                <div class="alert alert-info">
                    <strong>üìä Statut Groupes</strong><br>
                    <strong>${statut.total_groupes || 0}</strong> groupes (<strong>${statut.groupes_actifs || 0}</strong> actifs)<br>
                    <strong>${details.classes_avec_groupes || 0}</strong> classes avec groupes sur <strong>${details.total_classes || 0}</strong><br>
                    Derni√®re sync: <strong>${lastSync}</strong>
                    ${statut.needs_sync ? '<br><span class="text-warning"><strong>üîÑ Sync recommand√©e</strong></span>' : ''}
                </div>
            `;
        }
    }
    
    _afficherErreur(erreur) {
        this._afficherNotification(`‚ùå Erreur lors de la synchronisation:\n\n${erreur}`, 'error');
    }
    
    _afficherNotification(message, type = 'info') {
        // Cr√©er une notification styl√©e
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show`;
        notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            <strong>${type === 'success' ? '‚úÖ' : '‚ùå'} ${type === 'success' ? 'Succ√®s' : 'Erreur'}</strong>
            <div style="white-space: pre-line; margin-top: 10px;">${message}</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-supprimer apr√®s 10 secondes
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 10000);
    }
    
    _afficherChargement(btn, texte) {
        btn.disabled = true;
        btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${texte}`;
        
        // Afficher un indicateur de progression
        const progression = document.createElement('div');
        progression.id = 'sync-progression';
        progression.className = 'alert alert-warning mt-2';
        progression.innerHTML = `
            <i class="fas fa-sync fa-spin"></i> 
            <strong>Synchronisation en cours...</strong><br>
            <small>Veuillez patienter, cette op√©ration peut prendre plusieurs minutes.</small>
            <div class="progress mt-2">
                <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
            </div>
        `;
        
        const statutElement = document.getElementById('statut-groupes');
        if (statutElement) {
            statutElement.parentNode.insertBefore(progression, statutElement.nextSibling);
        }
    }
    
    _restaurerBouton(btn, texte) {
        btn.disabled = false;
        btn.innerHTML = texte;
        
        // Supprimer l'indicateur de progression
        const progression = document.getElementById('sync-progression');
        if (progression) {
            progression.remove();
        }
    }
    
    _getBoutonSync() {
        return document.getElementById('btn-sync-groupes');
    }
}

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    const sync = new GroupeSynchronizer();
    
    // Bouton de synchronisation
    const btnSync = document.getElementById('btn-sync-groupes');
    if (btnSync) {
        btnSync.addEventListener('click', () => sync.synchroniser());
    }
    
    // V√©rifier le statut au chargement
    sync.verifierStatut();
    
    // V√©rifier le statut toutes les 60 secondes
    setInterval(() => sync.verifierStatut(), 60000);
    
    // Exposer globalement pour debug
    window.syncGroupes = sync;
});

// Fonction globale pour appel depuis HTML
function sync_groupes() {
    const sync = new GroupeSynchronizer();
    sync.synchroniser();
}

// ########################Syncro des groupe ######################################################

// Synchroniser toutes les donn√©es
function syncAllData() {
    if (!confirm('Synchroniser toutes les classes et maquettes ? Cela peut prendre quelques minutes.')) {
        return;
    }
    
    const btn = event.target;
    const originalHTML = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Synchronisation...';
    
    fetch('{% url "sync_all_api_data" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ Synchronisation compl√®te r√©ussie !');
            location.reload();
        } else {
            alert('‚ùå Erreur: ' + data.error);
        }
    })
    .catch(error => {
        alert('‚ùå Erreur: ' + error);
    })
    .finally(() => {
        btn.disabled = false;
        btn.innerHTML = originalHTML;
    });
}

// Initialiser et mettre √† jour toutes les secondes
updateFullDateTime(); // Appel initial
setInterval(updateFullDateTime, 1000); // Mise √† jour toutes les secondes

</script>
</body>
</html>